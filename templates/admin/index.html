{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block page_title %}داشبورد مدیریت GPS{% endblock %}

{% block extrahead %}
{{ block.super }}
{% endblock %}

{% block content %}
<!-- کارت‌های آماری -->
<div class="stats-cards">
    <div class="stat-card">
        <div class="stat-header">
            <div class="stat-title">دستگاه‌های فعال</div>
            <div class="stat-icon gps">
                <i class="fas fa-toggle-on"></i>
            </div>
        </div>
        <div class="stat-value">{{ admin_device_stats.active|default:0 }}</div>
    </div>

    <div class="stat-card">
        <div class="stat-header">
            <div class="stat-title">دستگاه‌های آنلاین</div>
            <div class="stat-icon active">
                <i class="fas fa-signal"></i>
            </div>
        </div>
        <div class="stat-value">{{ admin_device_stats.online|default:0 }}</div>
    </div>

    <div class="stat-card">
        <div class="stat-header">
            <div class="stat-title">دستگاه‌های در حال انقضا</div>
            <div class="stat-icon inactive">
                <i class="fas fa-hourglass-half"></i>
            </div>
        </div>
        <div class="stat-value">{{ admin_device_stats.expiring|default:0 }}</div>
    </div>

    <div class="stat-card">
        <div class="stat-header">
            <div class="stat-title">دستگاه‌های منقضی شده</div>
            <div class="stat-icon inactive">
                <i class="fas fa-circle-xmark"></i>
            </div>
        </div>
        <div class="stat-value">{{ admin_device_stats.expired|default:0 }}</div>
    </div>
</div>

<div class="table-container">
    <div class="table-header">
        <div class="table-title">مدیریت بخش‌ها</div>
    </div>

    {% if app_list %}
    <div class="gps-app-grid">
        {% for app in app_list %}
        <section class="gps-app-card">
            <div class="gps-app-card__header">
                <a class="gps-app-card__title" href="{{ app.app_url }}">{{ app.name }}</a>
                <span class="gps-app-card__meta">{{ app.app_label }}</span>
            </div>
            <div class="gps-app-card__body">
                {% for model in app.models %}
                <div class="gps-model-row">
                    <div class="gps-model-row__name">{{ model.name }}</div>
                    <div class="gps-model-row__actions">
                        {% if model.admin_url %}
                        <a class="btn btn-secondary" href="{{ model.admin_url }}">لیست</a>
                        {% endif %}
                        {% if model.add_url %}
                        <a class="btn btn-primary" href="{{ model.add_url }}">افزودن</a>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </section>
        {% endfor %}
    </div>
    {% else %}
    <div class="content" style="padding: 20px; color: var(--text-secondary);">
        {% trans "You don't have permission to view or edit anything." %}
    </div>
    {% endif %}
</div>

<!-- جدول دستگاه‌ها (نمونه نمایشی) -->
<div class="table-container">
    <div class="table-header">
        <div class="table-title">دستگاه‌های GPS</div>
        <div class="table-actions">
            <a class="btn btn-primary" href="{% url 'admin:gps_devices_device_add' %}">
                <i class="fas fa-plus"></i>
                افزودن دستگاه
            </a>
            <a class="btn btn-secondary" href="{% url 'admin:gps_devices_device_changelist' %}">
                <i class="fas fa-list"></i>
                لیست دستگاه‌ها
            </a>
        </div>
    </div>

    <table>
        <thead>
            <tr>
                <th>شناسه دستگاه</th>
                <th>نام دستگاه</th>
                <th>مدل</th>
                <th>مالک</th>
                <th>وضعیت</th>
                <th>آخرین موقعیت</th>
                <th>آخرین بروزرسانی</th>
                <th>عملیات</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>GPS-2023-001</td>
                <td>ون حمل و نقل</td>
                <td>Tracker Pro X</td>
                <td>شرکت باربری آسان</td>
                <td>آنلاین</td>
                <td>تهران، خیابان ولیعصر</td>
                <td>۲ دقیقه پیش</td>
                <td>
                    <div class="table-actions">
                        <a class="btn btn-secondary" href="{% url 'admin:gps_devices_device_changelist' %}">مشاهده</a>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
{% endblock %}
